<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´§è½¦æ•°æ®åˆ†æAgent - æ™ºèƒ½APIæ¨èç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            position: relative;
            overflow: hidden;
        }
        
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .tag-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .tag-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .tag-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .tag-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .result-card {
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-slate-900 to-gray-800 min-h-screen">
    
    <!-- Hero Header -->
    <header class="gradient-bg text-white relative">
        <div class="container mx-auto px-4 py-12 relative z-10">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-20 h-20 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm floating">
                        <i class="fas fa-truck text-4xl"></i>
                    </div>
                    <div>
                        <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight">
                            ğŸš› è´§è½¦æ•°æ®åˆ†æAgent
                        </h1>
                        <p class="text-lg md:text-xl opacity-90 mt-2 font-medium">
                            æ™ºèƒ½APIæ¨è Â· ç‚¹å‡»æ ‡ç­¾è·å–æœ€ä½³æ¥å£æ–¹æ¡ˆ
                        </p>
                    </div>
                </div>
                <a href="/old-index" class="px-6 py-3 bg-white/20 hover:bg-white/30 rounded-xl font-semibold transition-all backdrop-blur-sm">
                    <i class="fas fa-database mr-2"></i>SQLæŸ¥è¯¢
                </a>
            </div>
            
            <!-- Stats Bar -->
            <div class="grid grid-cols-4 gap-4 mt-8">
                <div class="glass-card rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold">11</div>
                    <div class="text-sm opacity-80">åˆ†æç»´åº¦</div>
                </div>
                <div class="glass-card rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold">AI</div>
                    <div class="text-sm opacity-80">æ™ºèƒ½æ¨è</div>
                </div>
                <div class="glass-card rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold">å®æ—¶</div>
                    <div class="text-sm opacity-80">æ•°æ®åˆ†æ</div>
                </div>
                <div class="glass-card rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold">ä¸“ä¸š</div>
                    <div class="text-sm opacity-80">è´§è¿ç›‘æ§</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-12 max-w-7xl">
        
        <!-- å…¶ä»–åŠŸèƒ½æ¨¡å—å…¥å£ -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <i class="fas fa-th-large text-orange-500"></i>
                å…¶ä»–åŠŸèƒ½æ¨¡å—
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- æ•°æ®åˆæˆæœåŠ¡ -->
                <a href="/data-synthesis" class="block group">
                    <div class="bg-gradient-to-r from-indigo-900/40 to-sky-900/40 border-2 border-indigo-700 rounded-xl p-6 hover:from-indigo-900/60 hover:to-sky-900/60 hover:border-indigo-500 transition-all hover:shadow-2xl hover:scale-[1.02]">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 to-sky-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg">
                                <i class="fas fa-random text-white text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-white text-xl mb-1 flex items-center gap-2">
                                    ğŸ² æ•°æ®åˆæˆæœåŠ¡
                                    <i class="fas fa-arrow-right text-indigo-400 text-sm group-hover:translate-x-2 transition-transform"></i>
                                </h3>
                                <p class="text-gray-400 text-sm">
                                    è§„åˆ™ç”Ÿæˆ + CTGAN æ¨¡å‹ç”Ÿæˆé—¨æ¶äº¤æ˜“æ•°æ®
                                </p>
                            </div>
                        </div>
                    </div>
                </a>

                <!-- DGMå¤§æ¨¡å‹ç”Ÿæˆ -->
                <a href="/dgm-generation" class="block group">
                    <div class="bg-gradient-to-r from-emerald-900/40 to-teal-900/40 border-2 border-emerald-700 rounded-xl p-6 hover:from-emerald-900/60 hover:to-teal-900/60 hover:border-emerald-500 transition-all hover:shadow-2xl hover:scale-[1.02]">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg">
                                <i class="fas fa-brain text-white text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-white text-xl mb-1 flex items-center gap-2">
                                    ğŸ¤– DGMå¤§æ¨¡å‹ç”Ÿæˆ
                                    <span class="text-xs bg-emerald-500 text-white px-2 py-1 rounded-full">ç”Ÿäº§çº§</span>
                                    <i class="fas fa-arrow-right text-emerald-400 text-sm group-hover:translate-x-2 transition-transform"></i>
                                </h3>
                                <p class="text-gray-400 text-sm">
                                    LLMæ™ºèƒ½ç”Ÿæˆ Â· åˆ¤åˆ«å¼éªŒè¯ Â· è´¨é‡è¯„åˆ†90%
                                </p>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </section>
        
        <!-- ç»Ÿä¸€æŸ¥è¯¢æ¨¡å— -->
        <div id="content-unified">
        <!-- Tags Section -->
        <section class="mb-12">
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-8 md:p-12 border border-slate-700">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-3">
                        <i class="fas fa-brain mr-3 text-orange-500"></i>AI éœ€æ±‚ç†è§£
                    </h2>
                    <p class="text-gray-400 mb-6">ç”¨è‡ªç„¶è¯­è¨€æè¿°æ‚¨çš„è´§è½¦æ•°æ®åˆ†æéœ€æ±‚ï¼ŒAIä¼šæ™ºèƒ½æ¨èæœ€åˆé€‚çš„APIæ¥å£</p>
                    
                    <!-- Natural Language Input -->
                    <div class="flex gap-4 mb-8">
                        <div class="flex-1 relative">
                            <i class="fas fa-comment-dots absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-500 text-xl"></i>
                            <input 
                                type="text" 
                                id="queryInput" 
                                class="w-full pl-14 pr-6 py-5 border-2 border-orange-600 bg-slate-700 text-white rounded-2xl text-lg placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:shadow-lg focus:shadow-orange-500/20 transition-all"
                                placeholder="ğŸ’¬ æè¿°æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæ‹¥å µæƒ…å†µã€é€šè¡Œè´¹ç”¨ã€è¶…è½½æ¯”ä¾‹ã€é«˜å³°æ—¶æ®µ... æˆ–è¾“å…¥"æ‰€æœ‰æ•°æ®"æŸ¥çœ‹å…¨éƒ¨"
                            >
                        </div>
                        <button 
                            onclick="queryByInput()" 
                            class="px-10 py-5 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white rounded-2xl font-bold text-lg shadow-lg hover:shadow-2xl hover:scale-105 transition-all"
                        >
                            <i class="fas fa-rocket mr-2"></i>AIåˆ†æ
                        </button>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-tags text-orange-500"></i>
                        å¿«é€Ÿæ ‡ç­¾
                        <span class="text-sm font-normal text-gray-400">(ç‚¹å‡»å¡«å……åˆ°è¾“å…¥æ¡†)</span>
                    </h3>
                </div>
                
                <!-- Analytics Tags Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                    <!-- Tag 1: æµé‡åˆ†æ -->
                    <button onclick="queryByTag('è´§è½¦æµé‡åˆ†æ')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-blue-900 to-blue-800 hover:from-blue-800 hover:to-blue-700 text-white rounded-2xl font-bold text-lg border-2 border-blue-700 hover:border-blue-500">
                        <div class="relative z-10">
                            <i class="fas fa-chart-line text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">æµé‡åˆ†æ</div>
                            <div class="text-xs opacity-75 mt-1">Traffic Flow</div>
                        </div>
                    </button>
                    
                    <!-- Tag 2: é€šè¡Œæ—¶é—´ -->
                    <button onclick="queryByTag('è´§è½¦é€šè¡Œæ—¶é—´')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-purple-900 to-purple-800 hover:from-purple-800 hover:to-purple-700 text-white rounded-2xl font-bold text-lg border-2 border-purple-700 hover:border-purple-500">
                        <div class="relative z-10">
                            <i class="fas fa-clock text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">é€šè¡Œæ—¶é—´</div>
                            <div class="text-xs opacity-75 mt-1">Travel Time</div>
                        </div>
                    </button>
                    
                    <!-- Tag 3: é€šè¡Œè´¹ç”¨ -->
                    <button onclick="queryByTag('è´§è½¦é€šè¡Œè´¹åˆ†æ')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-green-900 to-green-800 hover:from-green-800 hover:to-green-700 text-white rounded-2xl font-bold text-lg border-2 border-green-700 hover:border-green-500">
                        <div class="relative z-10">
                            <i class="fas fa-dollar-sign text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">é€šè¡Œè´¹ç”¨</div>
                            <div class="text-xs opacity-75 mt-1">Toll Fee</div>
                        </div>
                    </button>
                    
                    <!-- Tag 4: æ‹¥å µæŒ‡æ•° -->
                    <button onclick="queryByTag('è´§è½¦æ‹¥å µæŒ‡æ•°')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-red-900 to-red-800 hover:from-red-800 hover:to-red-700 text-white rounded-2xl font-bold text-lg border-2 border-red-700 hover:border-red-500">
                        <div class="relative z-10">
                            <i class="fas fa-traffic-light text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">æ‹¥å µæŒ‡æ•°</div>
                            <div class="text-xs opacity-75 mt-1">Congestion</div>
                        </div>
                    </button>
                    
                    <!-- Tag 5: è¶…è½½ç›‘æµ‹ -->
                    <button onclick="queryByTag('è´§è½¦è¶…è½½ç›‘æµ‹')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-yellow-900 to-yellow-800 hover:from-yellow-800 hover:to-yellow-700 text-white rounded-2xl font-bold text-lg border-2 border-yellow-700 hover:border-yellow-500">
                        <div class="relative z-10">
                            <i class="fas fa-weight text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">è¶…è½½ç›‘æµ‹</div>
                            <div class="text-xs opacity-75 mt-1">Overweight</div>
                        </div>
                    </button>
                    
                    <!-- Tag 6: ä¼˜æƒ åˆ†æ -->
                    <button onclick="queryByTag('è´§è½¦ä¼˜æƒ åˆ†æ')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-indigo-900 to-indigo-800 hover:from-indigo-800 hover:to-indigo-700 text-white rounded-2xl font-bold text-lg border-2 border-indigo-700 hover:border-indigo-500">
                        <div class="relative z-10">
                            <i class="fas fa-tags text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">ä¼˜æƒ åˆ†æ</div>
                            <div class="text-xs opacity-75 mt-1">Discount</div>
                        </div>
                    </button>
                    
                    <!-- Tag 7: é«˜å³°æ—¶æ®µ -->
                    <button onclick="queryByTag('è´§è½¦é«˜å³°æ—¶æ®µ')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-pink-900 to-pink-800 hover:from-pink-800 hover:to-pink-700 text-white rounded-2xl font-bold text-lg border-2 border-pink-700 hover:border-pink-500">
                        <div class="relative z-10">
                            <i class="fas fa-calendar-alt text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">é«˜å³°æ—¶æ®µ</div>
                            <div class="text-xs opacity-75 mt-1">Peak Hours</div>
                        </div>
                    </button>
                    
                    <!-- Tag 8: è½´æ•°åˆ†æ -->
                    <button onclick="queryByTag('è´§è½¦è½´æ•°åˆ†æ')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-teal-900 to-teal-800 hover:from-teal-800 hover:to-teal-700 text-white rounded-2xl font-bold text-lg border-2 border-teal-700 hover:border-teal-500">
                        <div class="relative z-10">
                            <i class="fas fa-truck-moving text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">è½´æ•°åˆ†æ</div>
                            <div class="text-xs opacity-75 mt-1">Axle Count</div>
                        </div>
                    </button>
                    
                    <!-- Tag 9: è½¦é“åˆ©ç”¨ -->
                    <button onclick="queryByTag('è½¦é“åˆ©ç”¨ç‡')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-cyan-900 to-cyan-800 hover:from-cyan-800 hover:to-cyan-700 text-white rounded-2xl font-bold text-lg border-2 border-cyan-700 hover:border-cyan-500">
                        <div class="relative z-10">
                            <i class="fas fa-road text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">è½¦é“åˆ©ç”¨</div>
                            <div class="text-xs opacity-75 mt-1">Lane Usage</div>
                        </div>
                    </button>
                    
                    <!-- Tag 10: ç«™ç‚¹çŠ¶æ€ -->
                    <button onclick="queryByTag('æ”¶è´¹ç«™è¿è¡ŒçŠ¶æ€')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-lime-900 to-lime-800 hover:from-lime-800 hover:to-lime-700 text-white rounded-2xl font-bold text-lg border-2 border-lime-700 hover:border-lime-500">
                        <div class="relative z-10">
                            <i class="fas fa-heartbeat text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">ç«™ç‚¹çŠ¶æ€</div>
                            <div class="text-xs opacity-75 mt-1">Station Status</div>
                        </div>
                    </button>
                    
                    <!-- Tag 11: å‡ºå£æ•°æ®kåŒ¿å -->
                    <button onclick="queryByTag('è´§è½¦å‡ºå£äº¤æ˜“æ•°æ®kåŒ¿å')" class="tag-btn group relative px-6 py-8 bg-gradient-to-br from-emerald-900 to-emerald-800 hover:from-emerald-800 hover:to-emerald-700 text-white rounded-2xl font-bold text-lg border-2 border-emerald-700 hover:border-emerald-500">
                        <div class="relative z-10">
                            <i class="fas fa-shield-alt text-4xl mb-3 group-hover:scale-110 transition-transform"></i>
                            <div class="text-base">å‡ºå£kåŒ¿å</div>
                            <div class="text-xs opacity-75 mt-1">k-Anonymity</div>
                        </div>
                    </button>
                </div>
                
                <!-- Quick Tips -->
                <div class="mt-8 bg-gradient-to-r from-blue-900/30 to-purple-900/30 border-2 border-blue-800/50 rounded-xl p-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-blue-900/60 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-lightbulb text-yellow-300 text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                ğŸ’¡ ä½¿ç”¨æŠ€å·§
                            </h4>
                            <ul class="text-gray-300 text-sm space-y-2">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                                    <span>ç›´æ¥æè¿°éœ€æ±‚ï¼šå¦‚"æŸ¥çœ‹æ‹¥å µæƒ…å†µ"ã€"åˆ†æé€šè¡Œè´¹"</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                                    <span>ç‚¹å‡»ä¸Šæ–¹å¿«é€Ÿæ ‡ç­¾å¯è‡ªåŠ¨å¡«å……æŸ¥è¯¢å†…å®¹</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                                    <span>æƒ³çœ‹å…¨éƒ¨ï¼Ÿè¾“å…¥"æ‰€æœ‰æ•°æ®"æˆ–"å…¨éƒ¨åŠŸèƒ½"å³å¯å±•ç¤ºæ‰€æœ‰API</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                                    <span>AIä¼šæ ¹æ®æ‚¨çš„éœ€æ±‚æ™ºèƒ½æ¨èæœ€åˆé€‚çš„APIæ¥å£</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="loading" class="hidden text-center py-16 mt-8">
                    <div class="inline-block">
                        <div class="w-20 h-20 border-8 border-orange-900 border-t-orange-400 rounded-full spinner"></div>
                    </div>
                    <p class="text-gray-300 mt-6 text-lg font-medium">
                        <span class="pulse-dot inline-block w-2 h-2 bg-orange-600 rounded-full mr-2"></span>
                        AIæ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...
                        <span class="pulse-dot inline-block w-2 h-2 bg-orange-600 rounded-full ml-2"></span>
                    </p>
                </div>
                
                <!-- Results Section -->
                <div id="results" class="hidden mt-8 space-y-6">
                    <!-- Analysis Card -->
                    <div class="result-card bg-gradient-to-br from-orange-900/40 to-red-900/40 border-2 border-orange-700 rounded-2xl p-6 shadow-2xl">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-robot text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-white">AI éœ€æ±‚åˆ†æç»“æœ</h3>
                        </div>
                        <div class="bg-slate-800/80 p-6 rounded-xl mb-4">
                            <p id="explanation" class="text-gray-300 text-lg leading-relaxed"></p>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-purple-900/40 border-2 border-purple-700 rounded-xl p-5">
                                <h5 class="font-bold text-purple-300 mb-3 text-lg flex items-center gap-2">
                                    <i class="fas fa-bullseye"></i>è¯†åˆ«åœºæ™¯
                                </h5>
                                <p id="scenario" class="text-gray-300"></p>
                            </div>
                            <div class="bg-blue-900/40 border-2 border-blue-700 rounded-xl p-5">
                                <h5 class="font-bold text-blue-300 mb-3 text-lg flex items-center gap-2">
                                    <i class="fas fa-database"></i>æ‰€éœ€æ•°æ®ç±»å‹
                                </h5>
                                <div id="dataTypes" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- API List Card -->
                    <div class="result-card bg-slate-800 border-2 border-slate-700 rounded-2xl p-6 shadow-2xl">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-list-ul text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-white">æ¨èçš„APIæ¥å£</h3>
                                <p class="text-sm text-gray-400 mt-1">å…±æ‰¾åˆ° <span id="apiCount" class="text-green-400 font-bold text-lg">0</span> ä¸ªç›¸å…³æ¥å£</p>
                            </div>
                        </div>
                        <div id="apiList" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </section>
        </div>
        
        <!-- å·¥ä½œæµç¼–æ’æ¨¡å— -->
        <div id="content-workflow" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- æ™ºèƒ½Agentå…¥å£ -->
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-6 border border-slate-700">
                    <div class="flex items-center mb-4">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-3 rounded-lg mr-3">
                            <i class="fas fa-robot text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-white">æ™ºèƒ½Agentå…¥å£</h2>
                            <p class="text-sm text-gray-400">è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œè‡ªåŠ¨ç¼–æ’æ‰§è¡Œ</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ğŸ’¬ è¾“å…¥æ‚¨çš„éœ€æ±‚</label>
                            <textarea 
                                id="agentQuery" 
                                rows="3" 
                                class="w-full px-4 py-3 bg-slate-700 text-white border border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘æ ¸ç®—é€šè¡Œè´¹&#10;æ£€æµ‹å¼‚å¸¸äº¤æ˜“&#10;åˆ†æå…¨ç½‘æµé‡æƒ…å†µ"></textarea>
                        </div>

                        <div class="bg-blue-900/30 border border-blue-700 rounded-lg p-3">
                            <p class="text-sm text-blue-300 font-medium mb-1">ğŸ’¡ ç¤ºä¾‹æŸ¥è¯¢ï¼š</p>
                            <div class="space-y-1">
                                <button onclick="setQuery('å¸®æˆ‘æ ¸ç®—2023å¹´1æœˆ3å·çš„é€šè¡Œè´¹')" 
                                        class="text-xs text-blue-400 hover:text-blue-300 hover:underline block">
                                    â€¢ å¸®æˆ‘æ ¸ç®—2023å¹´1æœˆ3å·çš„é€šè¡Œè´¹
                                </button>
                                <button onclick="setQuery('æ£€æµ‹æœ€è¿‘çš„å¼‚å¸¸äº¤æ˜“')" 
                                        class="text-xs text-blue-400 hover:text-blue-300 hover:underline block">
                                    â€¢ æ£€æµ‹æœ€è¿‘çš„å¼‚å¸¸äº¤æ˜“
                                </button>
                                <button onclick="setQuery('åˆ†æå…¨ç½‘çš„æµé‡æƒ…å†µ')" 
                                        class="text-xs text-blue-400 hover:text-blue-300 hover:underline block">
                                    â€¢ åˆ†æå…¨ç½‘çš„æµé‡æƒ…å†µ
                                </button>
                            </div>
                        </div>

                        <button 
                            onclick="executeAgent()" 
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-500 hover:to-purple-500 transition duration-200 flex items-center justify-center">
                            <i class="fas fa-bolt mr-2"></i>æ™ºèƒ½æ‰§è¡Œ
                        </button>
                    </div>
                </div>

                <!-- å·¥ä½œæµç›´æ¥è°ƒç”¨ -->
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-6 border border-slate-700">
                    <div class="flex items-center mb-4">
                        <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white p-3 rounded-lg mr-3">
                            <i class="fas fa-tasks text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-white">å·¥ä½œæµç›´æ¥è°ƒç”¨</h2>
                            <p class="text-sm text-gray-400">é€‰æ‹©åœºæ™¯ï¼Œé…ç½®å‚æ•°æ‰§è¡Œ</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ğŸ¯ é€‰æ‹©åœºæ™¯</label>
                            <select id="scenarioSelect" onchange="updateScenarioInfo()" 
                                    class="w-full px-4 py-3 bg-slate-700 text-white border border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">-- è¯·é€‰æ‹©å·¥ä½œæµåœºæ™¯ --</option>
                                <option value="scenario1">åœºæ™¯1: è·¨è·¯æ®µé€šè¡Œè´¹æ ¸ç®—</option>
                                <option value="scenario2">åœºæ™¯2: å¼‚å¸¸äº¤æ˜“ç¨½æ ¸</option>
                                <option value="scenario3">åœºæ™¯3: å…¨ç½‘æµé‡åˆ†æ</option>
                            </select>
                        </div>

                        <div id="scenarioInfo" class="bg-slate-700/50 border border-slate-600 rounded-lg p-3 hidden">
                            <p class="text-sm font-medium text-gray-300 mb-2">åœºæ™¯è¯´æ˜ï¼š</p>
                            <p id="scenarioDescription" class="text-sm text-gray-400"></p>
                        </div>

                        <div id="paramsSection" class="space-y-3 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" id="startDate" value="2023-01-03"
                                       class="w-full px-3 py-2 bg-slate-700 text-white border border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div id="endDateDiv" class="hidden">
                                <label class="block text-sm font-medium text-gray-300 mb-1">ç»“æŸæ—¥æœŸ</label>
                                <input type="date" id="endDate" value="2023-01-10"
                                       class="w-full px-3 py-2 bg-slate-700 text-white border border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div id="limitDiv" class="hidden">
                                <label class="block text-sm font-medium text-gray-300 mb-1">æŸ¥è¯¢æ•°é‡</label>
                                <input type="number" id="limit" value="20" min="1" max="100"
                                       class="w-full px-3 py-2 bg-slate-700 text-white border border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>

                        <button 
                            onclick="executeWorkflow()" 
                            class="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-500 hover:to-teal-500 transition duration-200 flex items-center justify-center">
                            <i class="fas fa-play mr-2"></i>æ‰§è¡Œå·¥ä½œæµ
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ‰§è¡ŒçŠ¶æ€ -->
            <div id="workflowLoading" class="hidden bg-slate-800 rounded-2xl shadow-2xl p-6 mb-6 border border-slate-700">
                <div class="flex items-center justify-center space-x-3">
                    <div class="spinner w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"></div>
                    <span class="text-lg text-white">æ­£åœ¨æ‰§è¡Œä¸­...</span>
                </div>
            </div>

            <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <div id="workflowResult" class="hidden">
                <div class="bg-slate-800 rounded-2xl shadow-2xl p-6 mb-6 border border-slate-700">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <span class="bg-green-600 text-white px-3 py-1 rounded-full text-sm mr-2">âœ“ æ‰§è¡ŒæˆåŠŸ</span>
                        <span id="resultScenarioName"></span>
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div id="statsCards"></div>
                    </div>

                    <!-- æ‰§è¡Œæ—¥å¿— -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-white mb-3">ğŸ“‹ æ‰§è¡Œæ—¥å¿—</h4>
                        <div class="bg-slate-700 rounded-lg p-4 max-h-40 overflow-y-auto">
                            <div id="executionLogs" class="space-y-2 font-mono text-sm text-gray-300"></div>
                        </div>
                    </div>

                    <!-- è¯¦ç»†ç»“æœ -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-white mb-3">ğŸ“Š è¯¦ç»†ç»“æœ</h4>
                        <div class="bg-slate-700 rounded-lg p-4">
                            <pre id="detailedResult" class="text-sm text-gray-300 whitespace-pre-wrap"></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é”™è¯¯æç¤º -->
            <div id="workflowError" class="hidden">
                <div class="bg-red-900/20 border border-red-700 rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-red-400 mb-2 flex items-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>æ‰§è¡Œå¤±è´¥
                    </h3>
                    <p id="errorMessage" class="text-red-300"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button id="backToTop" 
            onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" 
            class="hidden fixed bottom-8 right-8 w-14 h-14 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white rounded-full shadow-2xl hover:shadow-orange-500/50 transition-all hover:scale-110 z-50">
        <i class="fas fa-arrow-up text-xl"></i>
    </button>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-10 mt-20 border-t border-gray-800">
        <div class="container mx-auto px-4">
            <div class="text-center mb-8">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <i class="fas fa-truck text-3xl text-orange-500"></i>
                    <h3 class="text-2xl font-bold">è´§è½¦æ•°æ®åˆ†æAgent</h3>
                </div>
                <p class="text-gray-400 mb-4">åŸºäºAIçš„æ™ºèƒ½APIæ¨èç³»ç»Ÿ Â· æ”¯æŒ11ç§ä¸“ä¸šåˆ†æç»´åº¦ï¼ˆå«å‡ºå£æ•°æ®k-åŒ¿åéšç§ä¿æŠ¤ï¼‰</p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8 mb-8 text-center md:text-left">
                <div>
                    <h4 class="font-bold text-lg mb-3 text-orange-400">ğŸ¯ æ ¸å¿ƒåŠŸèƒ½</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li>â€¢ è‡ªç„¶è¯­è¨€ç†è§£</li>
                        <li>â€¢ æ™ºèƒ½APIæ¨è</li>
                        <li>â€¢ å®æ—¶æ•°æ®åˆ†æ</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-3 text-orange-400">ğŸ“Š åˆ†æç»´åº¦</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li>â€¢ æµé‡ Â· æ—¶é—´ Â· è´¹ç”¨</li>
                        <li>â€¢ æ‹¥å µ Â· åˆè§„ Â· ä¼˜æƒ </li>
                        <li>â€¢ é«˜å³° Â· è½´æ•° Â· è½¦é“ Â· ç«™ç‚¹</li>
                        <li>â€¢ ğŸ”’ å‡ºå£æ•°æ®k-åŒ¿åä¿æŠ¤</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-3 text-orange-400">âš¡ æŠ€æœ¯æ ˆ</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li>â€¢ Flask Backend</li>
                        <li>â€¢ OpenAI GPT-4</li>
                        <li>â€¢ Tailwind CSS</li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-800 pt-6 text-center">
                <p class="text-gray-500 text-sm">
                    &copy; 2024 é«˜é€Ÿå…¬è·¯è´§è½¦æ•°æ®åˆ†æAgent Â· All Rights Reserved
                </p>
            </div>
        </div>
    </footer>
    
    <script>
        const baseUrl = window.location.origin;
        
        // Back to top button visibility
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.scrollY > 300) {
                backToTop.classList.remove('hidden');
            } else {
                backToTop.classList.add('hidden');
            }
        });

        // Fill tag text to input and trigger query
        function queryByTag(tagName) {
            const input = document.getElementById('queryInput');
            if (input) {
                input.value = tagName;
                queryByInput();
            }
        }

        // Query by input text
        async function queryByInput() {
            const input = document.getElementById('queryInput');
            if (!input) {
                console.error('æŸ¥è¯¢è¾“å…¥æ¡†ä¸å­˜åœ¨');
                return;
            }
            
            const query = input.value.trim();
            if (!query) {
                alert('ğŸ’­ è¯·è¾“å…¥æ‚¨çš„è´§è½¦åˆ†æéœ€æ±‚');
                return;
            }

            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            if (!loading || !results) {
                console.error('é¡µé¢å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            loading.classList.remove('hidden');
            results.classList.add('hidden');

            try {
                const response = await fetch(`${baseUrl}/api/agent/query`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query })
                });

                const data = await response.json();
                console.log('æ”¶åˆ°å“åº”æ•°æ®:', data);
                
                loading.classList.add('hidden');
                
                if (data.success) {
                    // ç»Ÿä¸€Agentè¿”å›æˆåŠŸï¼Œæ ¹æ®execution_typeæ˜¾ç¤ºä¸åŒç±»å‹çš„ç»“æœ
                    console.log('æ‰§è¡Œç±»å‹:', data.execution_type);
                    console.log('æ¨èåˆ—è¡¨:', data.recommendations);
                    displayUnifiedResults(data);
                    results.classList.remove('hidden');
                    
                    // Smooth scroll to results
                    setTimeout(() => {
                        results.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                } else if (data.understood) {
                    // å…¼å®¹æ—§ç‰ˆAgentæ ¼å¼
                    displayResults(data);
                    results.classList.remove('hidden');
                } else {
                    // æ˜¾ç¤ºé”™è¯¯æç¤º
                    showErrorMessage(data.error || data.message || 'AIæš‚æ—¶æ— æ³•ç†è§£æ‚¨çš„éœ€æ±‚', data.available_tags);
                }
            } catch (error) {
                loading.classList.add('hidden');
                showErrorMessage('æŸ¥è¯¢æœåŠ¡å‡ºç°é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•', null, error.message);
            }
        }
        
        function showErrorMessage(message, tags, technicalDetail) {
            const results = document.getElementById('results');
            results.innerHTML = `
                <div class="result-card bg-gradient-to-br from-red-900/40 to-orange-900/40 border-2 border-red-700 rounded-2xl p-8 text-center">
                    <div class="w-20 h-20 bg-red-900/60 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-3">æœªèƒ½ç†è§£æ‚¨çš„éœ€æ±‚</h3>
                    <p class="text-gray-300 text-lg mb-6">${message}</p>
                    ${technicalDetail ? `<p class="text-gray-500 text-sm mb-6">æŠ€æœ¯è¯¦æƒ…: ${technicalDetail}</p>` : ''}
                    ${tags ? `
                        <div class="bg-slate-800/50 rounded-xl p-6 mt-6">
                            <p class="text-gray-400 mb-4">ğŸ’¡ æ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹æ ‡ç­¾ï¼š</p>
                            <div class="flex flex-wrap gap-2 justify-center">
                                ${tags.slice(0, 5).map(tag => `
                                    <button onclick="queryByTag('${tag.name}')" 
                                            class="px-4 py-2 bg-blue-900/60 hover:bg-blue-800 text-blue-300 rounded-lg text-sm font-semibold border border-blue-700 transition-all hover:scale-105">
                                        ${tag.name}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    <button onclick="document.getElementById('queryInput').focus()" 
                            class="mt-6 px-6 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold transition-all hover:scale-105">
                        <i class="fas fa-redo mr-2"></i>é‡æ–°è¾“å…¥
                    </button>
                </div>
            `;
            results.classList.remove('hidden');
            results.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function displayNoResults() {
            const results = document.getElementById('results');
            results.innerHTML = `
                <div class="result-card bg-gradient-to-br from-blue-900/40 to-indigo-900/40 border-2 border-blue-700 rounded-2xl p-12 text-center">
                    <div class="w-24 h-24 bg-blue-900/60 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-search text-5xl text-blue-300"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-4">æœªæ‰¾åˆ°åŒ¹é…çš„API</h3>
                    <p class="text-gray-300 text-lg mb-6">è¯·å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æˆ–ç‚¹å‡»ä¸Šæ–¹çš„å¿«é€Ÿæ ‡ç­¾</p>
                    <button onclick="location.reload()" 
                            class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold transition-all hover:scale-105">
                        <i class="fas fa-refresh mr-2"></i>åˆ·æ–°é¡µé¢
                    </button>
                </div>
            `;
            results.classList.remove('hidden');
            results.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function displaySuccessMessage(count) {
            if (count === 0) {
                displayNoResults();
                return;
            }
            
            // æ·»åŠ æˆåŠŸæç¤ºåŠ¨ç”»
            const apiCount = document.getElementById('apiCount');
            if (apiCount) {
                apiCount.classList.add('animate-pulse');
                setTimeout(() => {
                    apiCount.classList.remove('animate-pulse');
                }, 1000);
            }
        }

        function displayUnifiedResults(data) {
            if (data.execution_type === 'api') {
                // APIæ¨èç»“æœ - å®Œå…¨ä½¿ç”¨æ—§ç‰ˆUI
                displayResults(data);
            } else if (data.execution_type === 'workflow') {
                // å·¥ä½œæµæ‰§è¡Œç»“æœ - ä½¿ç”¨æ–°UI
                displayWorkflowResultUnified(data);
            } else {
                showErrorMessage('è¿”å›äº†æœªçŸ¥çš„ç»“æœç±»å‹', null);
            }
        }
        
        function displayWorkflowResultUnified(data) {
            const resultsContainer = document.getElementById('results');
            const result = data.result || {};
            const plan = data.plan || {};
            const apiCalls = data.api_calls || [];
            const executionLogs = data.execution_logs || [];
            
            // æ„å»ºå¤šæ™ºèƒ½ä½“æ‰§è¡Œç»“æœå¡ç‰‡
            let html = `
                <div class="result-card bg-gradient-to-br from-green-900/30 via-emerald-900/30 to-teal-900/30 border-2 border-green-700 rounded-2xl p-6 shadow-lg mb-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white"></i>
                        </div>
                        <h4 class="text-xl font-bold text-white">å¤šæ™ºèƒ½ä½“åˆ†æç»“æœ</h4>
                    </div>
                    <div class="space-y-3">
                        <p class="text-gray-300"><strong>æŸ¥è¯¢éœ€æ±‚ï¼š</strong>${data.query}</p>
                        <p class="text-gray-300"><strong>ä»»åŠ¡ç†è§£ï¼š</strong>${plan.task_understanding || data.scenario_description || 'è‡ªä¸»è§„åˆ’æ‰§è¡Œ'}</p>
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 bg-green-900/60 text-green-300 rounded-full text-sm font-bold border border-green-700">
                                <i class="fas fa-check mr-1"></i>åˆ†æå®Œæˆ
                            </span>
                            ${apiCalls.length > 0 ? `
                            <span class="px-3 py-1 bg-blue-900/60 text-blue-300 rounded-full text-sm font-medium border border-blue-700">
                                <i class="fas fa-database mr-1"></i>è°ƒç”¨${apiCalls.length}ä¸ªAPI
                            </span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºæ•´ä½“æ‘˜è¦
            if (result.summary) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-blue-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-lightbulb text-yellow-400"></i>
                            åˆ†ææ‘˜è¦
                        </h5>
                        <p class="text-gray-300 leading-relaxed">${result.summary}</p>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºå…³é”®å‘ç°
            if (result.key_findings && result.key_findings.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-purple-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-search text-purple-400"></i>
                            å…³é”®å‘ç°
                        </h5>
                        <ul class="space-y-3">
                `;
                result.key_findings.forEach((finding, index) => {
                    html += `
                        <li class="flex items-start gap-3 bg-purple-900/20 border border-purple-700 rounded-lg p-3">
                            <span class="flex-shrink-0 w-6 h-6 bg-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${index + 1}
                            </span>
                            <span class="text-gray-300 flex-1">${finding}</span>
                        </li>
                    `;
                });
                html += `
                        </ul>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
            if (result.statistics && Object.keys(result.statistics).length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-slate-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-pie text-blue-400"></i>
                            ç»Ÿè®¡æ•°æ®
                        </h5>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                `;
                
                Object.entries(result.statistics).forEach(([key, value]) => {
                    // è‡ªåŠ¨é€‰æ‹©é¢œè‰²
                    const colors = ['blue', 'green', 'purple', 'yellow', 'red', 'cyan', 'indigo', 'pink'];
                    const color = colors[Math.abs(key.split('').reduce((a, b) => a + b.charCodeAt(0), 0)) % colors.length];
                    
                    html += `
                        <div class="bg-${color}-900/40 border border-${color}-700 rounded-lg p-4 hover:bg-${color}-900/60 transition-all">
                            <p class="text-sm text-${color}-400 font-medium">${key}</p>
                            <p class="text-2xl font-bold text-${color}-300 mt-2">${value}</p>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºå»ºè®®
            if (result.recommendations && result.recommendations.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-green-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-clipboard-check text-green-400"></i>
                            ä¼˜åŒ–å»ºè®®
                        </h5>
                        <ul class="space-y-3">
                `;
                result.recommendations.forEach((rec, index) => {
                    html += `
                        <li class="flex items-start gap-3 bg-green-900/20 border border-green-700 rounded-lg p-3">
                            <span class="flex-shrink-0 text-green-400">
                                <i class="fas fa-check-circle"></i>
                            </span>
                            <span class="text-gray-300 flex-1">${rec}</span>
                        </li>
                    `;
                });
                html += `
                        </ul>
                    </div>
                `;
            }
            
            // æ„å»ºç»Ÿè®¡æ•°æ®å¡ç‰‡
            const stats = [];
            
            // åœºæ™¯1ï¼šé€šè¡Œè´¹æ ¸ç®—
            if (result.entrance_count !== undefined) {
                stats.push({ label: 'å…¥å£äº¤æ˜“', value: result.entrance_count, color: 'blue', icon: 'sign-in-alt' });
                stats.push({ label: 'å‡ºå£äº¤æ˜“', value: result.exit_count, color: 'green', icon: 'sign-out-alt' });
                if (result.gantry_count !== undefined) {
                    stats.push({ label: 'é—¨æ¶äº¤æ˜“', value: result.gantry_count, color: 'cyan', icon: 'archway' });
                }
                stats.push({ label: 'æ€»äº¤æ˜“æ•°', value: result.total_transactions || (result.entrance_count + result.exit_count), color: 'indigo', icon: 'list-ol' });
                stats.push({ label: 'æ€»åº”æ”¶', value: result.total_toll_money + 'å…ƒ', color: 'yellow', icon: 'coins' });
                stats.push({ label: 'å®æ”¶é‡‘é¢', value: result.total_real_money + 'å…ƒ', color: 'purple', icon: 'money-bill-wave' });
                if (result.exit_toll_money !== undefined && result.gantry_toll_money !== undefined) {
                    stats.push({ label: 'å‡ºå£è´¹ç”¨', value: result.exit_toll_money + 'å…ƒ', color: 'green', icon: 'dollar-sign' });
                    stats.push({ label: 'é—¨æ¶è´¹ç”¨', value: result.gantry_toll_money + 'å…ƒ', color: 'cyan', icon: 'dollar-sign' });
                }
            } 
            // åœºæ™¯2ï¼šå¼‚å¸¸äº¤æ˜“ç¨½æ ¸
            else if (result.anomaly_count !== undefined) {
                stats.push({ label: 'æ£€æŸ¥äº¤æ˜“', value: result.total_checked, color: 'blue', icon: 'search' });
                stats.push({ label: 'å¼‚å¸¸äº¤æ˜“', value: result.anomaly_count, color: 'red', icon: 'exclamation-triangle' });
                stats.push({ label: 'å¼‚å¸¸ç‡', value: result.anomaly_rate + '%', color: 'orange', icon: 'percent' });
                if (result.statistics?.avg_fee) {
                    stats.push({ label: 'å¹³å‡è´¹ç”¨', value: result.statistics.avg_fee + 'å…ƒ', color: 'green', icon: 'chart-line' });
                }
            } 
            // åœºæ™¯3ï¼šå…¨ç½‘æµé‡åˆ†æ
            else if (result.total_flow !== undefined) {
                stats.push({ label: 'ç»Ÿè®¡è·¯æ®µ', value: result.total_sections, color: 'blue', icon: 'road' });
                stats.push({ label: 'æ€»æµé‡', value: result.total_flow + 'æ¬¡', color: 'green', icon: 'car' });
                if (result.busiest_section) {
                    stats.push({ label: 'æœ€ç¹å¿™è·¯æ®µ', value: result.busiest_section.section_name, color: 'purple', icon: 'chart-bar' });
                    stats.push({ label: 'æœ€é«˜æµé‡', value: result.busiest_section.flow + 'æ¬¡', color: 'red', icon: 'arrow-up' });
                }
            }
            
            if (stats.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-slate-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-pie text-blue-400"></i>
                            ç»Ÿè®¡æ•°æ®
                        </h5>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                `;
                
                stats.forEach(stat => {
                    html += `
                        <div class="bg-${stat.color}-900/40 border border-${stat.color}-700 rounded-lg p-4 hover:bg-${stat.color}-900/60 transition-all">
                            <p class="text-sm text-${stat.color}-400 font-medium flex items-center gap-2">
                                <i class="fas fa-${stat.icon}"></i>
                                ${stat.label}
                            </p>
                            <p class="text-2xl font-bold text-${stat.color}-300 mt-2">${stat.value}</p>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºå¼‚å¸¸è®°å½•ï¼ˆåœºæ™¯2ï¼‰
            if (result.anomalies && result.anomalies.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-slate-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle text-red-400"></i>
                            å¼‚å¸¸è®°å½• (å‰${Math.min(result.anomalies.length, 10)}æ¡)
                        </h5>
                        <div class="space-y-3">
                `;
                
                result.anomalies.slice(0, 10).forEach((anomaly, index) => {
                    html += `
                        <div class="bg-red-900/20 border border-red-700 rounded-lg p-4">
                            <div class="flex items-start justify-between mb-2">
                                <span class="text-red-300 font-bold">#${index + 1}</span>
                                <span class="px-2 py-1 bg-red-900/60 text-red-300 rounded text-xs font-semibold">
                                    ${anomaly.anomaly_reason || 'å¼‚å¸¸'}
                                </span>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm text-gray-300">
                                <div><strong>äº¤æ˜“ID:</strong> ${anomaly.exit_transaction_id || 'N/A'}</div>
                                <div><strong>è´¹ç”¨:</strong> ${anomaly.toll_money || 'N/A'}å…ƒ</div>
                                <div><strong>è½¦ç‰Œ:</strong> ${anomaly.plate_no || 'N/A'}</div>
                                <div><strong>æ—¶é—´:</strong> ${anomaly.exit_time ? new Date(anomaly.exit_time).toLocaleString('zh-CN') : 'N/A'}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºè·¯æ®µæµé‡æ’è¡Œï¼ˆåœºæ™¯3ï¼‰
            if (result.section_flows && result.section_flows.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-slate-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-trophy text-yellow-400"></i>
                            è·¯æ®µæµé‡æ’è¡Œ
                        </h5>
                        <div class="space-y-3">
                `;
                
                result.section_flows.forEach((section, index) => {
                    const rankColors = ['yellow', 'gray', 'orange', 'blue', 'blue'];
                    const color = rankColors[Math.min(index, 4)];
                    html += `
                        <div class="bg-${color}-900/20 border border-${color}-700 rounded-lg p-4 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <span class="text-${color}-300 font-bold text-2xl w-8">#${index + 1}</span>
                                <div>
                                    <p class="text-white font-semibold">${section.section_name || section.section_id}</p>
                                    <p class="text-gray-400 text-sm">${section.section_id}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-${color}-300 font-bold text-xl">${section.flow}</p>
                                <p class="text-gray-400 text-sm">æ¬¡é€šè¡Œ</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºAPIè°ƒç”¨è®°å½•
            if (apiCalls.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-cyan-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-plug text-cyan-400"></i>
                            APIè°ƒç”¨è®°å½•ï¼ˆ${apiCalls.length}ä¸ªï¼‰
                        </h5>
                        <div class="space-y-3">
                `;
                
                apiCalls.forEach((call, index) => {
                    const statusColor = call.success ? 'green' : 'red';
                    const statusIcon = call.success ? 'check-circle' : 'times-circle';
                    html += `
                        <div class="bg-slate-900/50 border border-${statusColor}-700 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-${statusColor}-400 font-bold">æ­¥éª¤${call.step}</span>
                                    <span class="px-2 py-1 bg-blue-900/60 text-blue-300 rounded text-xs font-mono">
                                        ${call.tool}
                                    </span>
                                </div>
                                <span class="text-${statusColor}-400">
                                    <i class="fas fa-${statusIcon}"></i>
                                </span>
                            </div>
                            ${Object.keys(call.params || {}).length > 0 ? `
                                <div class="text-sm text-gray-400 mt-2">
                                    <strong>å‚æ•°ï¼š</strong>${JSON.stringify(call.params)}
                                </div>
                            ` : ''}
                            ${call.result && call.result.count !== undefined ? `
                                <div class="text-sm text-gray-300 mt-2">
                                    <strong>è¿”å›ï¼š</strong>${call.result.count} æ¡è®°å½•
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºè¯¦ç»†æ•°æ®è®°å½•
            if (result.detailed_data && Object.keys(result.detailed_data).length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-indigo-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-table text-indigo-400"></i>
                            æŸ¥è¯¢ç»“æœæ˜ç»†
                        </h5>
                        <div class="space-y-4">
                `;
                
                Object.entries(result.detailed_data).forEach(([key, dataInfo]) => {
                    const records = dataInfo.records || [];
                    const count = dataInfo.count || 0;
                    
                    if (records.length > 0) {
                        html += `
                            <div class="bg-slate-900/50 border border-indigo-600 rounded-lg p-4">
                                <h6 class="text-md font-semibold text-indigo-300 mb-3">
                                    ${key} - å…±${count}æ¡è®°å½•ï¼ˆå±•ç¤ºå‰${records.length}æ¡ï¼‰
                                </h6>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-gray-300">
                                        <thead class="text-xs uppercase bg-slate-800 text-gray-400">
                                            <tr>
                        `;
                        
                        // åŠ¨æ€ç”Ÿæˆè¡¨å¤´
                        if (records[0]) {
                            Object.keys(records[0]).forEach(field => {
                                html += `<th class="px-3 py-2 text-left">${field}</th>`;
                            });
                        }
                        
                        html += `
                                            </tr>
                                        </thead>
                                        <tbody>
                        `;
                        
                        // æ˜¾ç¤ºæ•°æ®è¡Œ
                        records.forEach((record, idx) => {
                            html += `<tr class="border-b border-slate-700 hover:bg-slate-800/50">`;
                            Object.values(record).forEach(value => {
                                // æ ¼å¼åŒ–å€¼æ˜¾ç¤º
                                let displayValue = value;
                                if (value === null || value === undefined) {
                                    displayValue = '-';
                                } else if (typeof value === 'number') {
                                    displayValue = value.toLocaleString('zh-CN');
                                } else if (typeof value === 'string' && value.includes('T')) {
                                    // å°è¯•æ ¼å¼åŒ–æ—¥æœŸ
                                    try {
                                        displayValue = new Date(value).toLocaleString('zh-CN');
                                    } catch(e) {
                                        displayValue = value;
                                    }
                                }
                                html += `<td class="px-3 py-2">${displayValue}</td>`;
                            });
                            html += `</tr>`;
                        });
                        
                        html += `
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        `;
                    }
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºæ‰§è¡Œæ—¥å¿—
            if (executionLogs.length > 0) {
                html += `
                    <div class="result-card bg-slate-800 border-2 border-slate-700 rounded-2xl p-6 shadow-lg mb-6">
                        <h5 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-terminal text-green-400"></i>
                            æ‰§è¡Œæ—¥å¿—ï¼ˆ${executionLogs.length}æ¡ï¼‰
                        </h5>
                        <div class="bg-slate-900/50 rounded-lg p-4 font-mono text-sm space-y-1 max-h-96 overflow-y-auto">
                `;
                
                executionLogs.forEach(log => {
                    // æ ¹æ®æ—¥å¿—å†…å®¹ç€è‰²
                    let color = 'gray-300';
                    if (log.includes('âœ“') || log.includes('æˆåŠŸ')) color = 'green-400';
                    else if (log.includes('âœ—') || log.includes('å¤±è´¥')) color = 'red-400';
                    else if (log.includes('[Planner]')) color = 'blue-400';
                    else if (log.includes('[DataFetcher]')) color = 'cyan-400';
                    else if (log.includes('[Analyzer]')) color = 'purple-400';
                    
                    html += `<div class="text-${color}">${log}</div>`;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            resultsContainer.innerHTML = html;
        }
        
        function displayAPIRecommendations(data) {
            const resultsContainer = document.getElementById('results');
            
            let html = `
                <div class="result-card bg-gradient-to-br from-purple-900/30 via-blue-900/30 to-indigo-900/30 border-2 border-purple-700 rounded-2xl p-6 shadow-lg mb-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white"></i>
                        </div>
                        <h4 class="text-xl font-bold text-white">AIåˆ†æç»“æœ</h4>
                    </div>
                    <div class="space-y-3">
                        <p class="text-gray-300"><strong>æŸ¥è¯¢éœ€æ±‚ï¼š</strong>${data.query}</p>
                        ${data.reason ? `<p class="text-gray-400 text-sm">${data.reason}</p>` : ''}
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 bg-green-900/60 text-green-300 rounded-full text-sm font-bold border border-green-700">
                                <i class="fas fa-check mr-1"></i>æ¨è ${data.count} ä¸ªAPI
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            // APIæ¨èåˆ—è¡¨
            if (data.recommendations && data.recommendations.length > 0) {
                data.recommendations.forEach((api, index) => {
                    html += `
                        <div class="result-card bg-gradient-to-br from-slate-700 to-slate-800 border-2 border-slate-600 rounded-2xl p-6 hover:border-orange-600 hover:shadow-2xl transition-all duration-300 mb-4">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <h5 class="text-2xl font-bold text-white mb-2">
                                        ${index + 1}. ${api.name}
                                    </h5>
                                    <p class="text-gray-400 mb-4">${api.description}</p>
                                </div>
                                <span class="px-3 py-1 bg-blue-900/60 text-blue-300 rounded-lg text-sm font-bold border border-blue-700">
                                    ${api.method || 'GET'}
                                </span>
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="text-sm font-bold text-gray-400 mb-2">APIç«¯ç‚¹</h6>
                                <div class="bg-slate-900/50 rounded-lg p-3 font-mono text-sm text-green-400">
                                    ${api.endpoint}
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="text-sm font-bold text-gray-400 mb-2">å®Œæ•´URLï¼ˆå¯ç›´æ¥è°ƒç”¨ï¼‰</h6>
                                <div class="bg-slate-900/50 rounded-lg p-3 font-mono text-xs text-blue-400 break-all">
                                    ${api.full_url || api.endpoint}
                                </div>
                                <button onclick="copyURL('${api.endpoint}', '${(api.full_url || api.endpoint).split('?')[1] || ''}')" 
                                        class="mt-2 px-4 py-2 bg-blue-900/60 hover:bg-blue-800 text-blue-300 rounded-lg text-sm font-semibold border border-blue-700 transition-all">
                                    <i class="fas fa-copy mr-2"></i>å¤åˆ¶URL
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            resultsContainer.innerHTML = html;
        }
        
        function copyURL(endpoint, params) {
            const fullUrl = params ? `${baseUrl}${endpoint}?${params}` : `${baseUrl}${endpoint}`;
            navigator.clipboard.writeText(fullUrl).then(() => {
                alert('âœ… URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        function copyAPIExample(button) {
            const url = button.getAttribute('data-url') || '';
            if (url) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('âœ… APIç¤ºä¾‹URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                });
            }
        }
        
        function testAPI(button) {
            const url = button.getAttribute('data-url') || '';
            if (url) {
                window.open(url, '_blank');
            }
        }
        
        function displayResults(data) {
            // Display explanation - æ·»åŠ å®‰å…¨æ£€æŸ¥
            const explanationEl = document.getElementById('explanation');
            if (explanationEl && data.explanation) {
                explanationEl.textContent = data.explanation;
            }
            
            // Display scenario - å…¼å®¹ä¸¤ç§æ ¼å¼
            const analysis = data.requirement_analysis || data.step1_requirement_analysis;
            if (analysis) {
                const scenarioEl = document.getElementById('scenario');
                if (scenarioEl && analysis.scenario) {
                    scenarioEl.textContent = analysis.scenario;
                }
                
                // Display matched tags
                const dataTypesContainer = document.getElementById('dataTypes');
                if (dataTypesContainer) {
                    dataTypesContainer.innerHTML = '';
                    
                    // æ˜¾ç¤ºæ ‡ç­¾åç§°
                    const tagNames = analysis.tag_names || analysis.required_data_types || [];
                    tagNames.forEach(tagName => {
                        const badge = document.createElement('span');
                        badge.className = 'px-4 py-2 bg-blue-900/60 text-blue-300 rounded-full text-sm font-bold border-2 border-blue-700';
                        badge.textContent = tagName;
                        dataTypesContainer.appendChild(badge);
                    });
                }
            }
            
            // Display API count with animation
            const apiCountEl = document.getElementById('apiCount');
            if (apiCountEl && data.recommendations) {
                const apiCount = data.recommendations.length;
                apiCountEl.textContent = apiCount;
                displaySuccessMessage(apiCount);
            }
            
            // Display API list
            const apiListContainer = document.getElementById('apiList');
            if (!apiListContainer || !data.recommendations) {
                return;
            }
            
            apiListContainer.innerHTML = '';
            
            data.recommendations.forEach((api, index) => {
                const apiCard = document.createElement('div');
                apiCard.className = 'bg-gradient-to-br from-slate-700 to-slate-800 border-2 border-slate-600 rounded-2xl p-6 hover:border-orange-600 hover:shadow-2xl transition-all duration-300 hover:scale-[1.01]';
                
                // Build use cases HTML if available
                let useCasesHTML = '';
                if (api.use_cases && api.use_cases.length > 0) {
                    useCasesHTML = `
                        <div class="mb-5">
                            <h6 class="text-sm font-bold text-gray-400 mb-3 flex items-center gap-2">
                                <i class="fas fa-lightbulb"></i>é€‚ç”¨åœºæ™¯
                            </h6>
                            <div class="flex flex-wrap gap-2">
                                ${api.use_cases.map(useCase => `
                                    <span class="px-3 py-1.5 bg-indigo-900/60 text-indigo-300 rounded-lg text-xs font-semibold border border-indigo-700">
                                        ${useCase}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Build tag HTML if available
                let tagHTML = '';
                if (api.tag_name) {
                    tagHTML = `
                        <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-orange-900/60 text-orange-300 rounded-lg text-sm font-bold border border-orange-700">
                            <i class="fas fa-tag"></i>${api.tag_name}
                        </div>
                    `;
                }
                
                // Build parameters HTML
                let paramsHTML = '';
                if (api.parameters && api.parameters.length > 0) {
                    // åˆ†ç±»å‚æ•°
                    const requiredParams = api.parameters.filter(p => p.required);
                    const optionalParams = api.parameters.filter(p => !p.required);
                    
                    paramsHTML = `
                        <div class="mb-5">
                            <h6 class="text-sm font-bold text-gray-400 mb-3 flex items-center gap-2">
                                <i class="fas fa-cog"></i>å‚æ•°è¯´æ˜
                                <span class="text-xs font-normal text-gray-500">
                                    (${requiredParams.length} ä¸ªå¿…éœ€, ${optionalParams.length} ä¸ªå¯é€‰)
                                </span>
                            </h6>
                            <div class="bg-slate-900/50 rounded-lg p-4 space-y-2.5">
                                ${api.parameters.map(param => `
                                    <div class="flex items-start gap-2.5 text-sm group hover:bg-slate-800/50 p-2 rounded-lg transition-colors">
                                        <code class="bg-slate-800 px-3 py-1.5 rounded-lg text-purple-400 font-mono text-xs flex-shrink-0">${param.name}</code>
                                        ${param.required ? 
                                            '<span class="px-2.5 py-1 bg-red-900/80 text-red-300 rounded-md text-xs font-bold flex-shrink-0">å¿…éœ€</span>' : 
                                            '<span class="px-2.5 py-1 bg-gray-700/80 text-gray-400 rounded-md text-xs flex-shrink-0">å¯é€‰</span>'
                                        }
                                        <span class="text-gray-400 group-hover:text-gray-300 transition-colors">${param.description}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                apiCard.innerHTML = `
                    <div class="flex items-start justify-between mb-5">
                        <div class="flex items-start gap-4 flex-1">
                            <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center text-2xl font-bold text-white shadow-lg flex-shrink-0">
                                ${index + 1}
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2 flex-wrap">
                                    <h5 class="text-xl font-bold text-white">${api.api_name || api.description}</h5>
                                    ${tagHTML}
                                </div>
                                <p class="text-sm text-gray-400 leading-relaxed">${api.description}</p>
                            </div>
                        </div>
                        <span class="px-4 py-2 bg-green-900/60 text-green-300 rounded-xl text-sm font-bold border-2 border-green-700 flex-shrink-0 ml-4">
                            ${api.method}
                        </span>
                    </div>
                    
                    ${useCasesHTML}
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-5">
                        <div>
                            <h6 class="text-sm font-bold text-gray-400 mb-2 flex items-center gap-2">
                                <i class="fas fa-link"></i>APIç«¯ç‚¹
                            </h6>
                            <div class="bg-slate-900 rounded-lg p-3 overflow-x-auto border border-slate-700">
                                <code class="text-blue-400 text-sm font-mono">${api.endpoint}</code>
                            </div>
                        </div>
                        <div>
                            <h6 class="text-sm font-bold text-gray-400 mb-2 flex items-center gap-2">
                                <i class="fas fa-server"></i>å®Œæ•´URL
                            </h6>
                            <div class="bg-slate-900 rounded-lg p-3 overflow-x-auto border border-slate-700">
                                <code class="text-cyan-400 text-sm font-mono break-all">${api.full_url}</code>
                            </div>
                        </div>
                    </div>
                    
                    ${paramsHTML}
                    
                    <div class="mb-5">
                        <h6 class="text-sm font-bold text-gray-400 mb-2 flex items-center gap-2">
                            <i class="fas fa-code"></i>è°ƒç”¨ç¤ºä¾‹
                        </h6>
                        <div class="bg-slate-900 rounded-lg p-4 overflow-x-auto border border-slate-700">
                            <code class="text-green-400 text-sm font-mono break-all">${api.example || api.example_url || api.endpoint}</code>
                        </div>
                        <div class="flex gap-2 mt-3">
                            <button onclick="copyAPIExample(this)" data-url="${api.example || api.example_url || api.endpoint || ''}" 
                                    class="px-4 py-2 bg-purple-900/60 hover:bg-purple-800 text-purple-300 rounded-lg text-sm font-semibold border border-purple-700 transition-all hover:scale-105">
                                <i class="fas fa-copy mr-2"></i>å¤åˆ¶ç¤ºä¾‹URL
                            </button>
                            <button onclick="testAPI(this)" data-url="${api.example || api.example_url || api.endpoint || ''}" 
                                    class="px-4 py-2 bg-blue-900/60 hover:bg-blue-800 text-blue-300 rounded-lg text-sm font-semibold border border-blue-700 transition-all hover:scale-105">
                                <i class="fas fa-external-link-alt mr-2"></i>åœ¨æ–°çª—å£æµ‹è¯•
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <h6 class="text-sm font-bold text-gray-400 flex items-center gap-2">
                                <i class="fas fa-file-code"></i>å“åº”ç¤ºä¾‹
                                ${api.response_example_before ? '<span class="ml-2 px-2 py-0.5 bg-yellow-900/50 text-yellow-400 text-xs rounded">å·²å¯ç”¨æ•°æ®è„±æ•</span>' : ''}
                            </h6>
                            <button onclick="copyToClipboard(JSON.stringify(${JSON.stringify(api.response_example)}, null, 2), 'å“åº”ç¤ºä¾‹')" 
                                    class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded text-xs font-semibold transition-all">
                                <i class="fas fa-copy mr-1"></i>å¤åˆ¶JSON
                            </button>
                        </div>
                        ${api.response_example_before ? `
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-xs text-red-400 mb-1 font-semibold"><i class="fas fa-times-circle mr-1"></i>å¤„ç†å‰ï¼ˆåŸå§‹æ•°æ®ï¼‰</div>
                                <div class="bg-red-950/30 rounded-lg p-3 overflow-x-auto max-h-60 border border-red-900/50">
                                    <pre class="text-gray-400 text-xs font-mono leading-relaxed">${JSON.stringify(api.response_example_before, null, 2)}</pre>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-green-400 mb-1 font-semibold"><i class="fas fa-check-circle mr-1"></i>å¤„ç†åï¼ˆè„±æ•æ•°æ®ï¼‰</div>
                                <div class="bg-green-950/30 rounded-lg p-3 overflow-x-auto max-h-60 border border-green-900/50">
                                    <pre class="text-green-300 text-xs font-mono leading-relaxed">${JSON.stringify(api.response_example, null, 2)}</pre>
                                </div>
                            </div>
                        </div>
                        ` : `
                        <div class="bg-slate-900 rounded-lg p-4 overflow-x-auto max-h-80 border border-slate-700">
                            <pre class="text-gray-300 text-xs font-mono leading-relaxed">${JSON.stringify(api.response_example, null, 2)}</pre>
                        </div>
                        `}
                    </div>
                `;
                
                apiListContainer.appendChild(apiCard);
            });
        }

        function copyToClipboard(text, label = 'å†…å®¹') {
            navigator.clipboard.writeText(text).then(() => {
                alert(`âœ… ${label}å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼`);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }

        // Enter key support
        const queryInput = document.getElementById('queryInput');
        if (queryInput) {
            queryInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    queryByInput();
                }
            });
            
            // Auto focus on input
            window.addEventListener('load', function() {
                queryInput.focus();
            });
        }
        
        // ========== å·¥ä½œæµç›¸å…³å‡½æ•° ==========
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tab) {
            const apiBtn = document.getElementById('tab-api');
            const workflowBtn = document.getElementById('tab-workflow');
            const apiContent = document.getElementById('content-api');
            const workflowContent = document.getElementById('content-workflow');
            
            if (tab === 'api') {
                apiBtn.className = 'flex-1 py-4 px-6 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-xl font-bold text-lg shadow-lg transition-all';
                workflowBtn.className = 'flex-1 py-4 px-6 bg-slate-700 text-gray-300 rounded-xl font-bold text-lg transition-all hover:bg-slate-600';
                apiContent.classList.remove('hidden');
                workflowContent.classList.add('hidden');
            } else {
                workflowBtn.className = 'flex-1 py-4 px-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold text-lg shadow-lg transition-all';
                apiBtn.className = 'flex-1 py-4 px-6 bg-slate-700 text-gray-300 rounded-xl font-bold text-lg transition-all hover:bg-slate-600';
                workflowContent.classList.remove('hidden');
                apiContent.classList.add('hidden');
            }
        }
        
        // åœºæ™¯ä¿¡æ¯
        const scenarios = {
            'scenario1': {
                name: 'è·¨è·¯æ®µé€šè¡Œè´¹æ ¸ç®—',
                description: 'æŸ¥è¯¢å…¥å£å’Œå‡ºå£äº¤æ˜“è®°å½•ï¼Œè®¡ç®—é€šè¡Œè´¹ç”¨å¹¶è¿›è¡Œæ ¸ç®—ã€‚æ¶‰åŠï¼šå…¥å£æ”¶è´¹ç«™ã€å‡ºå£æ”¶è´¹ç«™ã€ç»“ç®—ä¸­å¿ƒ',
                params: ['start_date', 'end_date']  // æ”¯æŒæ—¥æœŸèŒƒå›´æŸ¥è¯¢
            },
            'scenario2': {
                name: 'å¼‚å¸¸äº¤æ˜“ç¨½æ ¸',
                description: 'è·å–çœŸå®äº¤æ˜“æ•°æ®ï¼Œç»“åˆè´§è½¦ç»Ÿè®¡ä¿¡æ¯ï¼Œæ£€æµ‹å¼‚å¸¸äº¤æ˜“ã€‚æ¶‰åŠï¼šç›‘ç®¡éƒ¨é—¨ã€æ”¶è´¹ç«™ã€ç»Ÿè®¡ä¸­å¿ƒ',
                params: ['start_date', 'end_date', 'limit']
            },
            'scenario3': {
                name: 'å…¨ç½‘æµé‡åˆ†æ',
                description: 'è·å–æ‰€æœ‰è·¯æ®µä¿¡æ¯ï¼Œç»Ÿè®¡å„è·¯æ®µæµé‡ï¼Œè¿›è¡Œèšåˆåˆ†æã€‚æ¶‰åŠï¼šè·¯ç½‘è¿è¥ä¸­å¿ƒã€å„è·¯æ®µç®¡ç†å¤„',
                params: ['start_date', 'end_date']
            }
        };
        
        function setQuery(query) {
            const textarea = document.getElementById('agentQuery');
            if (textarea) textarea.value = query;
        }
        
        function updateScenarioInfo() {
            const select = document.getElementById('scenarioSelect');
            const scenario = select.value;
            const infoDiv = document.getElementById('scenarioInfo');
            const paramsDiv = document.getElementById('paramsSection');
            const descDiv = document.getElementById('scenarioDescription');

            if (scenario && scenarios[scenario]) {
                infoDiv.classList.remove('hidden');
                paramsDiv.classList.remove('hidden');
                descDiv.textContent = scenarios[scenario].description;

                document.getElementById('endDateDiv').classList.add('hidden');
                document.getElementById('limitDiv').classList.add('hidden');

                if (scenarios[scenario].params.includes('end_date')) {
                    document.getElementById('endDateDiv').classList.remove('hidden');
                }
                if (scenarios[scenario].params.includes('limit')) {
                    document.getElementById('limitDiv').classList.remove('hidden');
                }
            } else {
                infoDiv.classList.add('hidden');
                paramsDiv.classList.add('hidden');
            }
        }
        
        async function executeAgent() {
            const query = document.getElementById('agentQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æŸ¥è¯¢å†…å®¹');
                return;
            }

            hideWorkflowResults();
            showWorkflowLoading();

            try {
                const response = await fetch('/api/agent/smart-query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                hideWorkflowLoading();

                if (result.success) {
                    displayWorkflowResult(result);
                } else {
                    displayWorkflowError(result.error || 'æ‰§è¡Œå¤±è´¥');
                }
            } catch (error) {
                hideWorkflowLoading();
                displayWorkflowError('ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }

        async function executeWorkflow() {
            const scenario = document.getElementById('scenarioSelect').value;
            if (!scenario) {
                alert('è¯·é€‰æ‹©å·¥ä½œæµåœºæ™¯');
                return;
            }

            const params = {
                start_date: document.getElementById('startDate').value
            };

            if (scenarios[scenario].params.includes('end_date')) {
                params.end_date = document.getElementById('endDate').value;
            }
            if (scenarios[scenario].params.includes('limit')) {
                params.limit = parseInt(document.getElementById('limit').value);
            }

            hideWorkflowResults();
            showWorkflowLoading();

            try {
                const response = await fetch('/api/workflow/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario, params })
                });

                const result = await response.json();
                hideWorkflowLoading();

                if (result.success) {
                    displayWorkflowResult(result);
                } else {
                    displayWorkflowError(result.error || 'æ‰§è¡Œå¤±è´¥');
                }
            } catch (error) {
                hideWorkflowLoading();
                displayWorkflowError('ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }

        function displayWorkflowResult(result) {
            document.getElementById('workflowResult').classList.remove('hidden');
            document.getElementById('resultScenarioName').textContent = 
                result.scenario_name || scenarios[result.scenario]?.name || 'å·¥ä½œæµ';

            const statsCards = document.getElementById('statsCards');
            statsCards.innerHTML = '';
            const data = result.result || {};

            const stats = [];
            if (data.entrance_count !== undefined) {
                stats.push({ label: 'å…¥å£äº¤æ˜“', value: data.entrance_count, color: 'blue' });
                stats.push({ label: 'å‡ºå£äº¤æ˜“', value: data.exit_count, color: 'green' });
                if (data.gantry_count !== undefined) {
                    stats.push({ label: 'é—¨æ¶äº¤æ˜“', value: data.gantry_count, color: 'cyan' });
                }
                stats.push({ label: 'æ€»äº¤æ˜“æ•°', value: data.total_transactions || (data.entrance_count + data.exit_count), color: 'indigo' });
                stats.push({ label: 'æ€»åº”æ”¶', value: data.total_toll_money + 'å…ƒ', color: 'yellow' });
                stats.push({ label: 'å®æ”¶é‡‘é¢', value: data.total_real_money + 'å…ƒ', color: 'purple' });
                if (data.exit_toll_money !== undefined && data.gantry_toll_money !== undefined) {
                    stats.push({ label: 'å‡ºå£è´¹ç”¨', value: data.exit_toll_money + 'å…ƒ', color: 'green' });
                    stats.push({ label: 'é—¨æ¶è´¹ç”¨', value: data.gantry_toll_money + 'å…ƒ', color: 'cyan' });
                }
            } else if (data.anomaly_count !== undefined) {
                stats.push({ label: 'æ£€æŸ¥äº¤æ˜“', value: data.total_checked, color: 'blue' });
                stats.push({ label: 'å¼‚å¸¸äº¤æ˜“', value: data.anomaly_count, color: 'red' });
                stats.push({ label: 'å¼‚å¸¸ç‡', value: data.anomaly_rate + '%', color: 'orange' });
                stats.push({ label: 'å¹³å‡è´¹ç”¨', value: (data.statistics?.avg_fee || 0) + 'å…ƒ', color: 'green' });
            } else if (data.total_flow !== undefined) {
                stats.push({ label: 'ç»Ÿè®¡è·¯æ®µ', value: data.total_sections, color: 'blue' });
                stats.push({ label: 'æ€»æµé‡', value: data.total_flow + 'æ¬¡', color: 'green' });
                if (data.busiest_section) {
                    stats.push({ label: 'æœ€ç¹å¿™è·¯æ®µ', value: data.busiest_section.section_name, color: 'purple' });
                }
            }

            stats.forEach(stat => {
                statsCards.innerHTML += `
                    <div class="bg-${stat.color}-900/40 border border-${stat.color}-700 rounded-lg p-4">
                        <p class="text-sm text-${stat.color}-400 font-medium">${stat.label}</p>
                        <p class="text-2xl font-bold text-${stat.color}-300 mt-1">${stat.value}</p>
                    </div>
                `;
            });

            const logsDiv = document.getElementById('executionLogs');
            logsDiv.innerHTML = '';
            (result.execution_logs || result.logs || []).forEach(log => {
                logsDiv.innerHTML += `<div class="text-gray-300">â†’ ${log}</div>`;
            });

            document.getElementById('detailedResult').textContent = 
                JSON.stringify(result.result, null, 2);
        }

        function displayWorkflowError(message) {
            document.getElementById('workflowError').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function showWorkflowLoading() {
            document.getElementById('workflowLoading').classList.remove('hidden');
        }

        function hideWorkflowLoading() {
            document.getElementById('workflowLoading').classList.add('hidden');
        }

        function hideWorkflowResults() {
            document.getElementById('workflowResult').classList.add('hidden');
            document.getElementById('workflowError').classList.add('hidden');
        }
    </script>
</body>
</html>
