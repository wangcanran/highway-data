# GPT-4智能Agent使用指南

## 📖 概述

本系统使用**GPT-4大语言模型**作为智能Agent，能够真正理解用户的自然语言需求，并智能推荐合适的API接口。

## 🚀 工作流程（两步）

### 第一步：需求理解（LLM）

GPT-4会分析用户的自然语言描述，理解：
- **应用场景**：用户想做什么（如：路径规划、交通分析等）
- **数据需求**：需要哪些类型的数据
- **理由说明**：为什么需要这些数据

**示例输入：**
```
用户："我需要做路径规划"
```

**GPT-4理解结果：**
```json
{
  "scenario_name": "路径规划",
  "description": "用户需要开发路径规划功能，计算高速公路上的最优路线",
  "reason": "路径规划需要了解路网拓扑结构、节点位置和连接关系",
  "required_data": ["sections", "toll_stations", "gantries"]
}
```

### 第二步：API匹配

根据第一步的分析结果，系统自动匹配对应的API接口：
- 路段信息API
- 收费站信息API
- 门架信息API

每个API都包含：
- ✅ 完整的接口地址
- ✅ 参数说明
- ✅ 调用示例
- ✅ 响应示例

## 🎯 支持的应用场景

### 1. 路径规划
**需求描述示例：**
- "我需要做路径规划"
- "开发导航系统需要什么数据"
- "计算最优路线"

**推荐数据：** 路段信息 + 收费站信息 + 门架信息

### 2. 交通分析
**需求描述示例：**
- "分析交通流量"
- "查看拥堵情况"
- "统计通行量"

**推荐数据：** 交易记录 + 统计分析

### 3. 收费报表
**需求描述示例：**
- "生成收费报表"
- "统计营收情况"
- "查看收费金额"

**推荐数据：** 交易记录 + 统计分析

### 4. 车型分析
**需求描述示例：**
- "分析车型分布"
- "统计车辆类型"
- "查看各类车辆占比"

**推荐数据：** 交易记录 + 统计分析

### 5. 其他场景
GPT-4可以理解各种表达方式，不局限于预定义的场景！

## 💡 使用技巧

### ✅ 推荐的提问方式

1. **描述目标**
   - "我想做路径规划"
   - "我需要分析交通流量"

2. **描述场景**
   - "开发一个导航系统"
   - "生成月度收费报表"

3. **描述数据需求**
   - "查询收费站信息"
   - "获取交易记录"

### ⚠️ 注意事项

1. **明确表达**：尽量清楚地描述你的需求
2. **场景导向**：说明你要做什么，而不只是要什么数据
3. **中英文都支持**：可以用中文或英文提问

## 🔧 LLM配置

当前配置（在`config.py`中）：

```python
# LLM配置
OPENAI_API_BASE = "https://4zapi.com/v1"
OPENAI_API_KEY = "sk-qwSKwMOCMlxEOaXTvtvQ2ZpiLsgxGZrPkMVNPPa1GIbKFCl6"
FIXED_MODEL_NAME = "gpt-4.1-2025-04-14"
REQUEST_TIMEOUT = 120
```

### 修改配置

1. 编辑 `config.py` 文件
2. 修改相应的配置项
3. 重启服务

## 🛡️ 容错机制

### 自动回退

当LLM服务出现问题时，系统会自动回退到**规则匹配模式**：
- ✅ 保证服务可用性
- ✅ 基于关键词匹配
- ✅ 预定义场景识别

### 错误处理

```python
try:
    # 使用LLM理解需求
    result = llm_understand(query)
except Exception as e:
    # 自动回退到规则匹配
    result = rule_based_match(query)
```

## 📊 效果对比

### 传统关键词匹配
```
输入："我需要数据做路径规划"
匹配：路径 → 仅返回路段数据
❌ 遗漏收费站和门架数据
```

### GPT-4智能理解
```
输入："我需要数据做路径规划"
理解：路径规划场景 → 需要路网拓扑
推荐：路段 + 收费站 + 门架
✅ 完整覆盖所需数据
```

## 🔍 调试和测试

### 测试Agent

运行测试脚本：
```bash
python test_agent.py
```

这会测试Agent对各种查询的理解能力。

### 查看日志

Agent处理时会输出日志：
- LLM调用状态
- 解析结果
- 错误信息（如果有）

## 💰 成本考虑

### API调用费用

每次用户查询会调用一次GPT-4 API：
- **模型**：gpt-4.1-2025-04-14
- **预计成本**：约 $0.001 - $0.003 / 次查询
- **优化建议**：
  - 可以添加缓存机制
  - 对常见查询直接返回结果
  - 只对复杂查询使用LLM

### 降低成本的方法

1. **添加缓存**
```python
# 缓存常见查询结果
query_cache = {
    "路径规划": cached_result_1,
    "交通分析": cached_result_2,
}
```

2. **使用更便宜的模型**
```python
# 在config.py中切换模型
FIXED_MODEL_NAME = "gpt-3.5-turbo"  # 更便宜但能力稍弱
```

## 🎓 示例对话

### 示例1：路径规划
```
用户："我要开发一个高速公路导航系统，需要什么数据？"

Agent分析：
✓ 场景：路径规划
✓ 说明：开发导航系统需要计算最优路径
✓ 原因：需要了解路网结构、节点位置和连接关系
✓ 数据：路段信息 + 收费站信息 + 门架信息

推荐API：
1. GET /api/sections - 获取所有路段
2. GET /api/toll-stations - 获取收费站列表
3. GET /api/gantries - 获取门架信息
```

### 示例2：交通分析
```
用户："帮我分析一下高速公路的拥堵情况"

Agent分析：
✓ 场景：交通分析
✓ 说明：分析高速公路交通流量和拥堵状况
✓ 原因：需要历史通行数据和流量统计
✓ 数据：交易记录 + 统计分析

推荐API：
1. GET /api/transactions/entrance - 入口交易记录
2. GET /api/transactions/exit - 出口交易记录
3. GET /api/statistics/traffic-flow - 交通流量统计
```

## 📚 相关文档

- [API使用指南](API_GUIDE.md) - 完整的API文档
- [README](README.md) - 项目总体说明
- [config.py](config.py) - 配置文件

## 🤝 反馈与改进

如果您发现：
- ❌ Agent理解错误
- ❌ 推荐的API不合适
- ✅ 有更好的提示词建议

欢迎提出反馈，帮助我们改进Agent的智能程度！

---

**版本**: v1.0 (LLM版本)  
**更新时间**: 2024-11-20
