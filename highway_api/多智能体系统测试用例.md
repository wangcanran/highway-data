# 多智能体系统测试用例

## 🎯 测试目标
验证多智能体系统（Planner → DataFetcher → Analyzer）能否正确处理各类查询，并遵守数据口径一致性原则。

---

## 📋 测试场景分类

### 1️⃣ 货车专项分析（只使用truck_only API）

#### 测试用例 1.1：流量分析
```
货车流量分析
```
**预期行为**：
- Planner选择：`get_hourly_flow`（货车专项API）
- 不混用：整体车辆API（如exit_transactions）
- 返回：小时流量统计数据

#### 测试用例 1.2：通行效率
```
分析货车的通行效率
```
**预期行为**：
- Planner选择：`get_avg_travel_time`（货车专项）
- 返回：平均通行时间数据

#### 测试用例 1.3：费用分析
```
货车通行费用分析
```
**预期行为**：
- Planner选择：`get_avg_toll_fee`（货车专项）
- 不选择：`get_exit_transactions`（整体API）
- 返回：平均费用统计

#### 测试用例 1.4：拥堵监测
```
货车拥堵指数监测
```
**预期行为**：
- Planner选择：`get_congestion_index`（货车专项）
- 返回：拥堵程度评估

#### 测试用例 1.5：高峰时段
```
分析货车高峰时段
```
**预期行为**：
- Planner选择：`get_peak_hours`（货车专项）
- 返回：流量最高的时段

---

### 2️⃣ 整体车辆分析（只使用all_vehicles API）

#### 测试用例 2.1：收入核算
```
核算2023年1月3号的高速公路收入
```
**预期行为**：
- Planner选择：`get_exit_transactions` + `get_gantry_transactions`（整体API）
- 不混用：货车专项API
- 返回：总收入、出口费用、门架费用

#### 测试用例 2.2：月度收入
```
核算2023年1月的通行费收入
```
**预期行为**：
- Planner正确解析日期范围：2023-01-01 到 2023-02-01
- 选择：整体车辆API
- 返回：月度总收入统计

#### 测试用例 2.3：全网流量
```
统计全网车辆通行数据
```
**预期行为**：
- Planner选择：`get_all_transactions` 或 `get_exit_transactions`（整体API）
- 返回：全网流量统计

---

### 3️⃣ 基础信息查询（中性API，无data_scope限制）

#### 测试用例 3.1：路段信息
```
查询路段信息
```
**预期行为**：
- Planner选择：`get_sections`
- 返回：路段列表（section_id, section_name, lanes等）

#### 测试用例 3.2：收费站信息
```
查询收费站信息
```
**预期行为**：
- Planner选择：`get_toll_stations`
- 返回：收费站列表

#### 测试用例 3.3：门架信息
```
查询门架设备信息
```
**预期行为**：
- Planner选择：`get_gantries`
- 返回：门架列表

---

### 4️⃣ 复杂查询（多步骤协作）

#### 测试用例 4.1：指定路段收入
```
核算麻文高速2023年1月3号的收入
```
**预期行为**：
- Planner正确识别：section_id="G5615530120", start_date="2023-01-03"
- 选择：`get_exit_transactions` + `get_gantry_transactions`（整体API，带路段参数）
- 返回：该路段的收入统计

#### 测试用例 4.2：日期范围查询
```
核算2023年1月3号到10号的通行费
```
**预期行为**：
- Planner正确解析日期范围：start_date="2023-01-03", end_date="2023-01-10"
- 选择：整体车辆API
- 返回：期间总收入

#### 测试用例 4.3：货车综合分析
```
分析货车的通行效率和拥堵情况
```
**预期行为**：
- Planner选择：`get_avg_travel_time` + `get_congestion_index`（都是货车专项）
- 不混用：整体车辆API
- 返回：效率和拥堵综合分析

---

### 5️⃣ 陷阱测试（验证是否混用API）

#### ❌ 陷阱用例 5.1：货车收入（易混用）
```
分析货车的收入情况
```
**正确行为**：
- Planner应识别"货车"关键词
- 只使用：`get_avg_toll_fee`（货车专项）
- **禁止**：调用`get_exit_transactions`（整体API）

**错误行为**（需避免）：
- ❌ 同时调用`get_exit_transactions`和`get_avg_toll_fee`（混用！）

#### ❌ 陷阱用例 5.2：货车数量统计（易混用）
```
统计货车通行数量
```
**正确行为**：
- 只使用：`get_hourly_flow`（货车专项）
- **禁止**：调用`get_all_transactions`后筛选vehicle_type

#### ❌ 陷阱用例 5.3：含糊查询
```
分析通行费用
```
**正确行为**：
- 用户未明确指定"货车"
- 优先使用：整体车辆API（`get_exit_transactions`）
- 不应默认使用货车专项API

---

## 🧪 验证要点

### ✅ 成功标准
1. **数据口径一致**：同一查询不混用truck_only和all_vehicles API
2. **字段驱动选择**：根据返回字段匹配需求，而非仅凭API名称
3. **日期正确解析**：准确识别日期格式和范围
4. **路段参数正确**：识别路段名称并转换为section_id
5. **结果结构完整**：包含summary、key_findings、statistics、recommendations

### ❌ 失败指标
1. 混用货车专项API和整体车辆API
2. API选择与需求不匹配
3. 日期参数缺失或错误
4. 返回数据为空但未提示
5. 分析结果缺少关键字段

---

## 🎯 标签快速测试

直接点击页面标签测试：

| 标签 | 填充查询 | 预期API |
|------|---------|---------|
| 🔵 流量分析 | 货车流量分析 | `get_hourly_flow` |
| 🟣 通行时间 | 货车通行时间 | `get_avg_travel_time` |
| 🟢 通行费用 | 货车通行费分析 | `get_avg_toll_fee` |
| 🔴 拥堵指数 | 货车拥堵指数 | `get_congestion_index` |
| 🟡 超载监测 | 货车超载监测 | `get_overweight_rate` |
| 🟠 优惠分析 | 货车优惠分析 | `get_discount_rate` |
| 🔵 高峰时段 | 货车高峰时段 | `get_peak_hours` |
| 🟦 轴数分析 | 货车轴数分析 | `get_avg_axle_count` |

---

## 📊 测试检查清单

- [ ] 测试用例 1.1-1.5（货车专项）
- [ ] 测试用例 2.1-2.3（整体车辆）
- [ ] 测试用例 3.1-3.3（基础信息）
- [ ] 测试用例 4.1-4.3（复杂查询）
- [ ] 陷阱用例 5.1-5.3（混用检测）
- [ ] 标签快速测试（8个标签）
- [ ] 前端显示：summary、key_findings、statistics、recommendations
- [ ] 前端显示：API调用记录、执行日志
- [ ] 日志颜色高亮：Planner蓝色、DataFetcher青色、Analyzer紫色

---

## 🔍 调试建议

1. **查看执行日志**：检查Planner选择了哪些API
2. **检查API调用记录**：验证参数是否正确
3. **查看后端控制台**：确认无混用警告
4. **验证返回数据**：确保统计数据准确

---

## 📝 备注

- 数据日期范围：主要数据集中在2023年1月-3月
- 默认路段：麻文高速（G5615530120），数据日期2023-01-03
- 测试环境：http://localhost:5000/truck-agent
- 测试顺序：建议先测基础用例，再测陷阱用例
